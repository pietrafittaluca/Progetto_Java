DROP DATABASE IF EXISTS `db_moodtraveling`;
CREATE SCHEMA `db_moodtraveling`;
USE db_moodtraveling;

create table UTENTE
(
    NOME            varchar(40) NOT NULL,
    COGNOME         varchar(40) NOT NULL,
    CITTA           varchar(40) NOT NULL,
    EMAIL           varchar(40) PRIMARY KEY,
    PASSWORD_U      varchar(40) NOT NULL
)CHARSET=UTF8MB4;

create table VIAGGIO
(
    NOME_OFFERTA    varchar(40) NOT NULL,
    LINK            varchar(500) PRIMARY KEY,
    CITTA           varchar(40) NOT NULL,
    TIPO            varchar(40) NOT NULL,
    
    CONSTRAINT CH_TIPO CHECK (TIPO IN ('Soggiorno', 'Giornata di Relax'))
)CHARSET=UTF8MB4;

create table ha
(
    EMAIL           varchar(40),
    LINK            varchar(500),

    CONSTRAINT FK_EMAIL FOREIGN KEY (EMAIL) REFERENCES UTENTE(EMAIL) ON DELETE CASCADE,
    CONSTRAINT FK_LINK FOREIGN KEY (LINK) REFERENCES VIAGGIO(LINK) ON DELETE CASCADE,
    CONSTRAINT PK_ha PRIMARY KEY (EMAIL, LINK)
)CHARSET=UTF8MB4;

create table RECENSIONE
(
    ID_RECENSIONE   int PRIMARY KEY AUTO_INCREMENT,
    TESTO           varchar(5000) NOT NULL,
    LINK            varchar(500) NOT NULL,

    CONSTRAINT FK_RECENSIONE_LINK FOREIGN KEY (LINK) REFERENCES VIAGGIO(LINK) ON DELETE CASCADE
)CHARSET=UTF8MB4;

create table SENTIMENT_SCORE
(
    ID_SENTIMENT    int PRIMARY KEY AUTO_INCREMENT,
    PERC_MOLTO_POS  FLOAT,
    PERC_POS        FLOAT,
    PERC_NEUTRO     FLOAT,
    PERC_NEGATIVO   FLOAT,
    PERC_MOLTO_NEG  FLOAT,

    CONSTRAINT CH_MOLTO_POS CHECK (PERC_MOLTO_POS >= 0 AND PERC_MOLTO_POS <= 100),
    CONSTRAINT CH_POS CHECK (PERC_POS >= 0 AND PERC_POS <= 100),
    CONSTRAINT CH_NEUTRO CHECK (PERC_NEUTRO >= 0 AND PERC_NEUTRO <= 100),
    CONSTRAINT CH_NEGATIVO CHECK (PERC_NEGATIVO >= 0 AND PERC_NEGATIVO <= 100),
    CONSTRAINT CH_MOLTO_NEG CHECK (PERC_MOLTO_NEG >= 0 AND PERC_MOLTO_NEG <= 100)
);

create table SENTIMENT_SCORE_TRAVEL
(
    ID_SENTIMENT    int NOT NULL,
    LINK            varchar(500) PRIMARY KEY,

    CONSTRAINT FK_LINK_SENTIMENT FOREIGN KEY (LINK) REFERENCES VIAGGIO(LINK) ON DELETE CASCADE,
    CONSTRAINT FK_ID_SENTIMENT FOREIGN KEY (ID_SENTIMENT) REFERENCES SENTIMENT_SCORE(ID_SENTIMENT) ON DELETE CASCADE
);

create table SENTIMENT_SCORE_REVIEW
(
    ID_SENTIMENT    int NOT NULL,
    ID_RECENSIONE   int PRIMARY KEY,

    CONSTRAINT FK_ID_RECENSIONE FOREIGN KEY (ID_RECENSIONE) REFERENCES RECENSIONE(ID_RECENSIONE) ON DELETE CASCADE,
    CONSTRAINT FK_ID_SENTIMENT_TRAVEL FOREIGN KEY (ID_SENTIMENT) REFERENCES SENTIMENT_SCORE(ID_SENTIMENT) ON DELETE CASCADE
);

----------------------------------------------------------------
-- INSERT --
----------------------------------------------------------------

-- UTENTE
INSERT INTO UTENTE(NOME, COGNOME, CITTA, EMAIL, PASSWORD_U)
VALUES('nome_root', 'cognome_root', 'citta_root', 'root@root.it', '0000');
INSERT INTO UTENTE(NOME, COGNOME, CITTA, EMAIL, PASSWORD_U)
VALUES('luca', 'esposito', 'milano', 'luca@luca.it', '0000');

-- VIAGGIO
INSERT INTO VIAGGIO(NOME_OFFERTA, LINK, CITTA, TIPO)
VALUES('nome_offerta_root', 'https://www.google.it', 'citta_root', 'Soggiorno');
INSERT INTO VIAGGIO(NOME_OFFERTA, LINK, CITTA, TIPO)
VALUES('nome_offerta_luca', 'https://www.hdblog.it', 'citta_luca', 'Soggiorno');
INSERT INTO VIAGGIO(NOME_OFFERTA, LINK, CITTA, TIPO)
VALUES('nome_offerta_luca', 'https://www.repubblica.it', 'citta_luca', 'Giornata di Relax');

-- ha
INSERT INTO ha(EMAIL, LINK)
VALUES('root@root.it', 'https://www.google.it');
INSERT INTO ha(EMAIL, LINK)
VALUES('luca@luca.it', 'https://www.hdblog.it');
INSERT INTO ha(EMAIL, LINK)
VALUES('luca@luca.it', 'https://www.repubblica.it');

-- RECENSIONE
INSERT INTO RECENSIONE(ID_RECENSIONE, TESTO, LINK)
VALUES(NULL, 'nel mezzo del cammin di nostra vita mi ritrovai per una selva oscura ...', 'https://www.google.it');
INSERT INTO RECENSIONE(ID_RECENSIONE, TESTO, LINK)
VALUES(NULL, 'che la diritta via era smarrita ...', 'https://www.google.it');

INSERT INTO RECENSIONE(ID_RECENSIONE, TESTO, LINK)
VALUES(NULL, 'recensione hdblog ...', 'https://www.hdblog.it');
INSERT INTO RECENSIONE(ID_RECENSIONE, TESTO, LINK)
VALUES(NULL, 'recensione repubblica ...', 'https://www.repubblica.it');

-- SENTIMENT_SCORE
INSERT INTO SENTIMENT_SCORE(ID_SENTIMENT, PERC_MOLTO_POS, PERC_POS, PERC_NEUTRO, PERC_NEGATIVO, PERC_MOLTO_NEG)
VALUES(NULL, 22.5, 22.5, 22.5, 20.5, 2);
INSERT INTO SENTIMENT_SCORE(ID_SENTIMENT, PERC_MOLTO_POS, PERC_POS, PERC_NEUTRO, PERC_NEGATIVO, PERC_MOLTO_NEG)
VALUES(NULL, 22.5, 22.5, 22.5, 20.5, 2);
INSERT INTO SENTIMENT_SCORE(ID_SENTIMENT, PERC_MOLTO_POS, PERC_POS, PERC_NEUTRO, PERC_NEGATIVO, PERC_MOLTO_NEG)
VALUES(NULL, 10.5, 10.5, 10.5, 10.5, 2);
INSERT INTO SENTIMENT_SCORE(ID_SENTIMENT, PERC_MOLTO_POS, PERC_POS, PERC_NEUTRO, PERC_NEGATIVO, PERC_MOLTO_NEG)
VALUES(NULL, 10.5, 10.5, 10.5, 10.5, 2);

-- SENTIMENT_SCORE_TRAVEL
INSERT INTO SENTIMENT_SCORE_TRAVEL(ID_SENTIMENT, LINK)
VALUES(1, 'https://www.google.it');
INSERT INTO SENTIMENT_SCORE_TRAVEL(ID_SENTIMENT, LINK)
VALUES(2, 'https://www.hdblog.it');
INSERT INTO SENTIMENT_SCORE_TRAVEL(ID_SENTIMENT, LINK)
VALUES(3, 'https://www.repubblica.it');

-- SENTIMENT_SCORE_REVIEW
INSERT INTO SENTIMENT_SCORE_REVIEW(ID_SENTIMENT, ID_RECENSIONE)
VALUES(3, 2);
INSERT INTO SENTIMENT_SCORE_REVIEW(ID_SENTIMENT, ID_RECENSIONE)
VALUES(4, 3);
